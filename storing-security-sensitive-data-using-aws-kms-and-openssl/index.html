<!DOCTYPE html>
 <html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-7aba2aea02e11131682e.js" as="script"/><link rel="preload" href="/component---src-templates-article-js-7a37d9aa7d04f24aca01.js" as="script"/><link rel="preload" href="/path---storing-security-sensitive-data-using-aws-kms-and-openssl-8322d11dc9e942067112.js" as="script"/><link rel="preload" href="/app-f85cf3bc30b5a17eb485.js" as="script"/><link rel="preload" href="/commons-3af2aa83d678b1ed7650.js" as="script"/><script id="webpack-manifest">
            //<![CDATA[
            window.webpackManifest = {"231608221292675":"app-f85cf3bc30b5a17eb485.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","131683993344931":"component---src-templates-article-js-7a37d9aa7d04f24aca01.js","212839066777427":"component---src-pages-blog-js-5d9a5447772b9a8feeb5.js","70144966829960":"component---src-pages-contact-js-f7d7c8f24ba630b067a6.js","35783957827783":"component---src-pages-index-js-f43ccf336d5fb008f152.js","111930841657428":"component---src-pages-project-js-8664cab9b2f05918b78b.js","60335399758886":"path----557518bd178906f8d58a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","256828598317467":"path---new-beginnings-e1df55b71366f133326e.js","121197226457594":"path---introduction-to-logic-programming-with-prolog-ed8430fd6ba2c6e1cf38.js","70709803819698":"path---brexit-call-for-collaboration-b6245407a0a7a6aee875.js","130421234821162":"path---storing-security-sensitive-data-using-aws-kms-and-openssl-8322d11dc9e942067112.js","49683490770531":"path---blog-b437f6cd7089edb0d94c.js","184662623972074":"path---contact-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-a0e39f21c11f6a62c5ab.js","82289178807862":"path---project-a0e39f21c11f6a62c5ab.js","114276838955818":"component---src-layouts-index-js-7aba2aea02e11131682e.js"}
            //]]>
            </script><title data-react-helmet="true">Painlessly storing security sensitive data using AWS KMS and OpenSSL</title><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true"></title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75em 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.15rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#d1066e;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}.gatsby-highlight{margin:.8em -1em;}.gatsby-resp-image-wrapper{margin:1.6rem -1rem 2.6rem -1rem;-webkit-filter:grayscale(100%);filter:url(/desaturate.svg#greyscale);}.gatsby-resp-image-wrapper:hover{-webkit-filter:none;filter:none;}.footnotes ol p{display:inline;}.footnotes ol .footnote-backref{display:inline;}</style><link href="//fonts.googleapis.com/css?family=Montserrat:700|Merriweather:400,400i,700,700i,900,900i" rel="stylesheet" type="text/css"/><script>
  !function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",[
  "/commons-3af2aa83d678b1ed7650.js","/app-f85cf3bc30b5a17eb485.js","/path---storing-security-sensitive-data-using-aws-kms-and-openssl-8322d11dc9e942067112.js","/component---src-templates-article-js-7a37d9aa7d04f24aca01.js","/component---src-layouts-index-js-7aba2aea02e11131682e.js"
])
  </script><style id="gatsby-inlined-css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100.50d27986.woff2) format("woff2"),url(/static/montserrat-latin-100.5e334eff.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic.8c070533.woff2) format("woff2"),url(/static/montserrat-latin-100italic.03e19243.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200.4343d3d9.woff2) format("woff2"),url(/static/montserrat-latin-200.f2022ecd.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic.116c4c4b.woff2) format("woff2"),url(/static/montserrat-latin-200italic.89614a60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300.d2ad295b.woff2) format("woff2"),url(/static/montserrat-latin-300.3a371ee0.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic.f6b6bf24.woff2) format("woff2"),url(/static/montserrat-latin-300italic.16521668.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400.240a8444.woff2) format("woff2"),url(/static/montserrat-latin-400.b20cc131.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic.86172bb8.woff2) format("woff2"),url(/static/montserrat-latin-400italic.9405e787.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500.fb8d6b71.woff2) format("woff2"),url(/static/montserrat-latin-500.50825d47.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic.c0a555a4.woff2) format("woff2"),url(/static/montserrat-latin-500italic.635de59c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600.d5615136.woff2) format("woff2"),url(/static/montserrat-latin-600.f300da4f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic.10f29d13.woff2) format("woff2"),url(/static/montserrat-latin-600italic.2bc37d86.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700.7d77e1f0.woff2) format("woff2"),url(/static/montserrat-latin-700.81826529.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic.1dd2b53f.woff2) format("woff2"),url(/static/montserrat-latin-700italic.c162d257.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800.d4e7bf86.woff2) format("woff2"),url(/static/montserrat-latin-800.895aadbf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic.fc0cbe44.woff2) format("woff2"),url(/static/montserrat-latin-800italic.b3362875.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900.c8bdd772.woff2) format("woff2"),url(/static/montserrat-latin-900.1b99ef78.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic.cb72c1f9.woff2) format("woff2"),url(/static/montserrat-latin-900italic.b78bb9f8.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300.a8258cd1.woff2) format("woff2"),url(/static/merriweather-latin-300.f5838312.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic.ff744a72.woff2) format("woff2"),url(/static/merriweather-latin-300italic.ebb3c5bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400.41389797.woff2) format("woff2"),url(/static/merriweather-latin-400.fc0d5525.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic.e6bb2aaf.woff2) format("woff2"),url(/static/merriweather-latin-400italic.8df98251.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700.7c4720f5.woff2) format("woff2"),url(/static/merriweather-latin-700.8081d883.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic.af53e7c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic.c9addd1f.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900.b64d6d00.woff2) format("woff2"),url(/static/merriweather-latin-900.3ca953c0.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic.566e2de4.woff2) format("woff2"),url(/static/merriweather-latin-900italic.5156ebd3.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style></head><body><div id="___gatsby"><div data-reactroot="" data-reactid="1" data-react-checksum="-1564828637"><div data-reactid="2"><div style="border-top:0.35rem solid;" data-reactid="3"></div><div style="max-width:42rem;margin-left:auto;margin-right:auto;padding:2.625rem 1.3125rem;" data-reactid="4"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:-1.75rem;" data-reactid="5"><a style="box-shadow:none;color:inherit;margin-right:0.35rem;text-decoration:none;" href="/" data-reactid="6">Home</a><span data-reactid="7"><span style="box-shadow:none;color:hsla(0,0%,0%,0.5);margin-right:0.35rem;text-decoration:none;" data-reactid="8">/</span><a style="box-shadow:none;color:inherit;text-decoration:none;" href="/blog/" data-reactid="9">Blog</a></span></h3><article data-reactid="10"><!-- react-empty: 11 --><h1 data-reactid="12"><a style="color:hsla(0,0%,0%,0.9);box-shadow:none;" href="/storing-security-sensitive-data-using-aws-kms-and-openssl/" data-reactid="13">Painlessly storing security sensitive data using AWS KMS and OpenSSL</a></h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-0.875rem;" data-reactid="14"><!-- react-text: 15 -->24 December, 2017<!-- /react-text --><!-- react-text: 16 -->, <!-- /react-text --><!-- react-text: 17 -->6 min read<!-- /react-text --></p><div data-reactid="18"><blockquote>
<p><em>TL;DR:</em> Check out the <a href="https://github.com/matchilling/aws-kms-boilerplate">aws-kms-boilerplate repository on GitHub</a> and have a look at the <code>encrypt</code> and <code>decrypt</code> shell scripts in the <code>bin/</code> directory.</p>
</blockquote>
<p>
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 47.69475357710652%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAAB5d8oVIKX/8QAGBAAAgMAAAAAAAAAAAAAAAAAAQIDEiD/2gAIAQEAAQUCQKRWPP8A/8QAGBEAAgMAAAAAAAAAAAAAAAAAAQIQETH/2gAIAQMBAT8BDCsj/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EABkQAAEFAAAAAAAAAAAAAAAAAAACESAhMv/aAAgBAQAGPwK1Mbj/AP/EABkQAAIDAQAAAAAAAAAAAAAAAAABICExwf/aAAgBAQABPyHWQd3A9h//2gAMAwEAAgADAAAAENPf/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAEDAQE/EIgM/8QAFxEBAAMAAAAAAAAAAAAAAAAAARARMf/aAAgBAgEBPxBV7H//xAAZEAADAAMAAAAAAAAAAAAAAAAAARExQWH/2gAIAQEAAT8QvuBBLZMQxUEMZ//Z'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Painlessly storing security sensitive data using AWS KMS"
        title="Photo by Matthew Brodeur"
        src="/static/what-the-fuck-3eb769a935eeddcda4e57624e4f798a8-631b1.jpeg"
        srcset="/static/what-the-fuck-3eb769a935eeddcda4e57624e4f798a8-30fbd.jpeg 200w,
/static/what-the-fuck-3eb769a935eeddcda4e57624e4f798a8-e87dc.jpeg 400w,
/static/what-the-fuck-3eb769a935eeddcda4e57624e4f798a8-631b1.jpeg 800w,
/static/what-the-fuck-3eb769a935eeddcda4e57624e4f798a8-300e3.jpeg 1200w,
/static/what-the-fuck-3eb769a935eeddcda4e57624e4f798a8-c15ef.jpeg 1600w,
/static/what-the-fuck-3eb769a935eeddcda4e57624e4f798a8-f76af.jpeg 1887w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  </p>
<p><a href="http://twitter.com/bpedro">Bruno Pedro</a> wrote a brief article recently on <a href="https://dev.to/bpedro/how-to-securely-store-api-keys-ab6">dev.to</a> about storing application credentials securely alongside your code and provided a short list of different solutions including <code>git-crypt</code>, <code>git-secret</code>, <code>git-remote-gcrypt</code> and Stack Overflow’s <a href="https://github.com/StackExchange/blackbox">BlackBox tool</a>.</p>
<p>While most of the tools are doing an excellent job I found, that one more or less obvious solution was missing in his enumeration. Because chances are high, that you are already running infrastructure/ code leveraging Amazon Web Services you may find a solution which doesn’t add another new service to your stack attractive.</p>
<p>The alternative I am going to briefly introduce uses <a href="https://aws.amazon.com/kms/">Amazon’s Key Management Service (KMS)</a>.</p>
<h2>Amazon’s key management service (KMS)</h2>
<p>AWS KMS is a fully managed service that makes it easy to create and control encryption keys on AWS which can then be utilised to encrypt and decrypt data in a safe way. The service leverages <a href="https://en.wikipedia.org/wiki/Hardware_security_module">Hardware Security Modules (HSM)</a> under the hood which in return guarantees security and integrity of the generated keys.</p>
<p>Compliance and security monitoring are ensured in KMS by using key-based permission policies and integrating with Amazon’s Identity and Access Management (IAM) which allows access management to a very granular level. KMS also offers hassle-free key-rotation and logs all events associated with a given key to AWS CloudTrail by default.</p>
<p>Let’s go quickly through the three <strong>main concepts</strong> KMS is based on before diving into the code example.</p>
<h3>KMS main concepts</h3>
<p>KMS utilises <a href="https://en.wikipedia.org/wiki/Symmetric-key_algorithm">symmetric encryption</a> which means that the key is used for encryption and decryption. We differentiate between two type of keys, Customer Master Keys and Data Keys.</p>
<ul>
<li>
<p>The <strong>Customer Master Key (CMK)</strong> is a logical key which represents the primary resource in AWS KMS. Master keys are either customer- or AWS managed and can be used to encrypt up to 4 kilobytes (4096 bytes) of raw data directly. CMKs are unique to your AWS account and the AWS region in which they are used.</p>
</li>
<li>
<p><strong>Data Keys</strong> are used to encrypt large data objects which exceed the 4KB-master-key limit. Be aware that Amazon Key Management in contrast to CMKs does not store any <em>Data Keys</em> and that the plain- and cypher-text of the generated key is being exposed.</p>
</li>
<li>
<p><strong>Envelope Encryption</strong> is a practice of encrypting plaintext data with a unique data key, and then encrypting the data key with a key encryption key (KEK).</p>
</li>
</ul>
<h2>Getting started</h2>
<p>In the following code example, I will demonstrate the core functions which are used in the <a href="https://github.com/matchilling/aws-kms-boilerplate">aws-kms-boilerplate repository</a>. I am going to assume that you have setup your AWS credentials correctly.</p>
<h3>1. Create a customer master key (CMK)</h3>
<p>The first step is to create a Customer Master Key. You can skip this step if you have already set up one which you want to use. You can retrieve a list of all your available master keys with the following AWS CLI command:</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ aws kms list-keys
</code></pre>
      </div>
<div class="gatsby-highlight">
      <pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">"Keys"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">"KeyArn"</span><span class="token operator">:</span> <span class="token string">"arn:aws:kms:region:************:key/********-****-****-****-************"</span><span class="token punctuation">,</span>
    <span class="token property">"KeyId"</span><span class="token operator">:</span> <span class="token string">"********-****-****-****-************"</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>If you don’t have a Customer Master Key set up or you want to use another one you can quickly create a new key with the following command:</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ aws kms create-key
</code></pre>
      </div>
<div class="gatsby-highlight">
      <pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">"KeyMetadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"Origin"</span><span class="token operator">:</span> <span class="token string">"AWS_KMS"</span><span class="token punctuation">,</span>
    <span class="token property">"KeyId"</span><span class="token operator">:</span> <span class="token string">"********-****-****-****-************"</span><span class="token punctuation">,</span>
    <span class="token property">"Description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token property">"Enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"KeyUsage"</span><span class="token operator">:</span> <span class="token string">"ENCRYPT_DECRYPT"</span><span class="token punctuation">,</span>
    <span class="token property">"KeyState"</span><span class="token operator">:</span> <span class="token string">"Enabled"</span><span class="token punctuation">,</span>
    <span class="token property">"CreationDate"</span><span class="token operator">:</span> <span class="token number">1513813027.113</span><span class="token punctuation">,</span>
    <span class="token property">"Arn"</span><span class="token operator">:</span> <span class="token string">"arn:aws:kms:region:************:key/********-****-****-****-************"</span><span class="token punctuation">,</span>
    <span class="token property">"AWSAccountId"</span><span class="token operator">:</span> <span class="token string">"************"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<h3>2. Create a key alias (optional)</h3>
<p>Assigning an alias to your master key is a handy thing to do as it simplifies the key-usage especially when you’re in your terminal and typing command manually. Most of the AWS KMS commands accept an alias as the <code>--key-id</code> parameter, so you don’t have to refer to the key by its long id.</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ aws kms create-alias \
  --alias-name <span class="token string">'alias/kms-tutorial'</span> \
  --target-key-id <span class="token string">'********-****-****-****-************'</span>
</code></pre>
      </div>
<h3>3. Create a data key</h3>
<p>With our new CMK will now generate a data key using the <code>generate-data-key</code> command which returns a data encryption key that we will later use to encrypt data locally. Note that we have defined the <code>--key-spec</code> parameter to generate a 256-bit long symmetrical encryption key using the <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES algorithm</a>.</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ aws kms generate-data-key \
  --key-id <span class="token string">'alias/kms-tutorial'</span> \
  --key-spec <span class="token string">'AES_256'</span> <span class="token operator">></span> <span class="token string">'./.key/data_key.json'</span>
</code></pre>
      </div>
<p>Note that the <code>Plaintext</code> and <code>CiphertextBlob</code> properties in the returned JSON are base64 encoded and that the <code>KeyId</code> does not refer the generated data key but to the Customer Master Key.</p>
<p><strong>It is important to understand that AWS KMS does not keep any records of your data key on their servers ~ so you have to manage those keys by yourself.</strong></p>
<div class="gatsby-highlight">
      <pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">"Plaintext"</span><span class="token operator">:</span> <span class="token string">"4XY5FgHP1JyH7SkNYjY6C6gpZlWLbG0jkw06dVu0B4I="</span><span class="token punctuation">,</span>
  <span class="token property">"KeyId"</span><span class="token operator">:</span> <span class="token string">"arn:aws:kms:region:************:key/********-****-****-****-************"</span><span class="token punctuation">,</span>
  <span class="token property">"CiphertextBlob"</span><span class="token operator">:</span> <span class="token string">"AQIDAHiP2nl/OYfqakZzv1qo7ir0iHai3O1Utd4q71Louy78XgGOk8YwfNOJo77u6nxAye/RAAAAfjB8BgkqhkiG9w0BBwagbzBtAgEAMGgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMWfzIpfhT/iCHuZBdAgEQgDvFMB7ItgfGhdDdKZj6dMpzdiyYLuGKXNK2WpCrl1wi0S8uCZdtKpllJMNlhLaRVeX0ghxMqD+JK8gSfQ=="</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<h3>4. Storing the CipherTextBlob</h3>
<p>Next, we are going to extract the <code>CipherTextBlob</code> from the <code>data_key.json</code> and base64 decode and store it in our repository. The OpenSSL toolkit provides a base64 implementation which we will use for the decoding.</p>
<p><strong>The blob contains meta-data about which CMK was used during data key creation. It will allow us to retrieve the plaintext key later on decryption.</strong></p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ <span class="token function">sed</span> -nr <span class="token string">'s/^.*"CiphertextBlob":\s*"(.*?)".*$/\1/p'</span> <span class="token string">'./.key/data_key.json'</span> \
  <span class="token operator">|</span> openssl base64 -d <span class="token operator">></span> <span class="token string">'./.key/ciphertext_blob_decoded'</span>
</code></pre>
      </div>
<h3>5. Encrypting the data</h3>
<p>Before we can start to encrypt our example data, we need to extract, and base64 decode the plaintext key from the <code>data_key.json</code> as we did with the <code>CipherTextBlob</code> in the previous step.</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ <span class="token function">sed</span> -nr <span class="token string">'s/^.*"Plaintext":\s*"(.*?)".*$/\1/p'</span> <span class="token string">'./.key/data_key.json'</span> \
  <span class="token operator">|</span> openssl base64 -d <span class="token operator">></span> <span class="token string">'./.key/plaintext_key_decoded'</span>
</code></pre>
      </div>
<p>As we now have stored the decoded cypher- and plaintext key in our <code>.key/</code> directory we can get rid of the <code>data_key.json</code> file as it is no longer needed.</p>
<p><em>Note that we are using the <a href="https://linux.die.net/man/1/shred"><code>shred</code></a> command rather than a simple <code>rm</code> to delete the key file securely.</em></p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ shred \
  --iterations<span class="token operator">=</span>100 \
  --remove<span class="token operator">=</span>wipesync \
  --zero <span class="token string">'./.key/data_key.json'</span>
</code></pre>
      </div>
<p>Finally, we can start to encrypt our data using OpenSSL and AES. In the following example we encrypt <code>.decrypted/database.json</code> with the plaintext key and store the result in <code>.encrypted/database.json</code>.</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ openssl enc -e -aes256 \
  -k <span class="token string">'fileb:///./.key/plaintext_key_decoded'</span> \
  -in <span class="token string">'.decrypted/database.json'</span> \
  -out <span class="token string">'.encrypted/database.json'</span>
</code></pre>
      </div>
<p>Next, we delete the plaintext key, but before doing so, we make sure that the base64 decoded <code>CipherTextBlob</code> has been stored correctly as the blob will be the only way to recover and decrypt our saved data.</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ shred \
  --iterations<span class="token operator">=</span>100 \
  --remove<span class="token operator">=</span>wipesync \
  --zero <span class="token string">'./.key/plaintext_key_decoded'</span>
</code></pre>
      </div>
<h3>6. Decrypting the data</h3>
<p>Decrypting data is the most straightforward part. As we have deleted the plaintext key after finishing our encryption, we need to restore it first by leveraging the <code>aws kms decrypt</code> command.</p>
<p>Because the <code>CipherTextBlob</code> contains meta-data, we do not need to tell KMS which CMK was used for the data key during creation-time.</p>
<p>Note that the original response from the decrypt command returns a JSON object with the Customer Master Key id. The query parameter allows us only to return the property we are interested in, which is handy as JSON manipulation in the terminal without libraries such as <code>awk</code>, or <code>jq</code> is quite messy and error-prone.</p>
<p>Before using the plaintext key, we need to base64 decode the response as we’ve done before.</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ aws kms decrypt \
  --ciphertext-blob <span class="token string">'fileb://./.key/ciphertext_blob_decoded'</span> \
  --query <span class="token string">'Plaintext'</span> \
  --output text <span class="token operator">|</span> openssl base64 -d -out <span class="token string">'./.key/plaintext_key_decoded'</span>
</code></pre>
      </div>
<p>Last, we pass the plaintext key to OpenSSL, and we get our encrypted example data decrypted.</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code>$ openssl enc -d -aes256 \
  -k <span class="token string">'fileb://./.key/plaintext_key_decoded'</span> \
  -in <span class="token string">'.encrypted/database.json'</span> \
  -out <span class="token string">'.decrypted/database.json'</span>
</code></pre>
      </div>
<h3>7. Log &#x26; audit CMK activity</h3>
<p>AWS Key Management Service integrates with <a href="https://aws.amazon.com/cloudtrail/">CloudTrail</a>, which captures API calls made by or on behalf of AWS KMS in your AWS account and writes the logs to an Amazon S3 bucket that you specify.
With CloudTrail’s help, you can determine what request was made, the source IP address from which the request was made, who made the request, when it was made, and so on.</p>
<h2>AWS KMS boilerplate</h2>
<p>I have created an accompanying <a href="https://github.com/matchilling/aws-kms-boilerplate">repository on GitHub</a> for this blog post which should help to demonstrate the basic usage of AWS KMS in your project.</p>
<p><strong>Basic usage:</strong></p>
<ul>
<li>Setup your AWS account</li>
<li>Create an AWS KMS Customer Master Key as described and assign an alias to it as described in step 1 and 2.</li>
<li>Place your security sensitive data such as API keys, database credentials etc. in the <code>.decrypted/</code> folder.</li>
<li>For encryption execute <code>./bin/encrypt --kms-id=alias/your-key</code>.</li>
<li>For decryption execute <code>./bin/decrypt</code>.</li>
<li><em>Note: activate the debugging mode by passing <code>--debug=true</code> into the script</em></li>
</ul>
<p>For further details check the <code>encrypt</code> and <code>decrypt</code> shell scripts in the <code>bin/</code> directory. Both scripts contain lots of comments which should make it trivial to follow the program.</p>
<h2>References</h2>
<ul>
<li><a href="https://github.com/matchilling/aws-kms-boilerplate">AWS KMS Boilerplate</a></li>
<li><a href="https://docs.aws.amazon.com/kms/latest/developerguide/overview.html">AWS Key Management Service Developer Guide</a></li>
<li><a href="https://www.openssl.org/docs/">OpenSSL Documentation</a></li>
</ul></div><hr style="margin-bottom:1.75rem;" data-reactid="19"/><div style="display:flex;" data-reactid="20"><img alt="Mathias Schilling" src="/static/profile.b2a1f82f.jpg" style="height:5.25rem;margin-bottom:0;margin-right:0.875rem;width:5.25rem;" data-reactid="21"/><p data-reactid="22"><!-- react-text: 23 -->99% of the time my brain is thinking blah, meh, why, huh, WTF, food and programming. The other 1% I’m usually asleep. You can find me<!-- /react-text --><!-- react-text: 24 --> <!-- /react-text --><a href="https://twitter.com/MatChilling" target="_blank" data-reactid="25">here</a><!-- react-text: 26 -->,<!-- /react-text --><!-- react-text: 27 --> <!-- /react-text --><a href="https://www.linkedin.com/in/matchilling" target="_blank" data-reactid="28">here</a><!-- react-text: 29 -->,<!-- /react-text --><!-- react-text: 30 --> <!-- /react-text --><a href="https://github.com/matchilling" target="_blank" data-reactid="31">here</a><!-- react-text: 32 --> <!-- /react-text --><!-- react-text: 33 -->and<!-- /react-text --><!-- react-text: 34 --> <!-- /react-text --><a href="https://www.last.fm/user/msatlastfm" target="_blank" data-reactid="35">there</a><!-- react-text: 36 -->.<!-- /react-text --></p></div></article><span style="display:block;clear:both;" data-reactid="37"> </span></div></div></div></div><script>
  
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75319994-1', 'auto');
  </script></body></html>